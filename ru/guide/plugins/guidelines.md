# Рекомендации {#guidelines}

Это рекомендации, которым должны следовать плагины, чтобы предоставить наилучший опыт использования в приложении Yskra


::: warning Work in progress

Рекомендации по разработке плагинов еще на стадии разработки и могут быть изменены в будущем

:::

## Общие рекомендации {#general}

1. Плагин не должен работать за пределами его предполагаемой функциональности
    - Это включает, помимо прочего: замену несвязанных компонентов, введение ненужных кнопок или бейджей

2. Плагин не должен изменять пользовательский интерфейс Yskra

     Это необходимо для обеспечения единообразия пользовательского интерфейса/UX, предотвращения путаницы пользователей и предотвращения ошибок

3. Плагин не должен собирать пользовательские данные без их согласия


## Код {#code}

1. Плагин не должен изменять глобальные поля, существующие `prototype` или внутренние модули

   ::: tip Примечание
   Модификация внутренностей Yskra ломает стабильность и может вызвать лицензионные вопросы по AGPL-3.0.  
   Используйте публичные API — это безопаснее и надёжнее.
   :::

2. Плагин должен удалять все свои изменения/модификации, когда размонтируется
   - Сюда входят изменения пользовательского интерфейса, исправления, интервалы, тайм-ауты и подписки
   - Также по возможности избегайте побочных эффектов при загрузке модуля (модуль выполняет какой-то код при импорте, но без запуска плагина например)
 
3. Высокая самодостаточность плагина
   - Полагаться минимально на вешние ресурсы 
   - Должен включать максимально необходимый код в свой `.js` файл
   - Включать все CSS стили в свой модуль
   - Если возможно, все ресурсы (иконки, изображения, воркеры) вместо URL должны использовать [Data:URI](https://developer.mozilla.org/ru/docs/Web/URI/Schemes/data)
   
   Это упростит распространение плагина без привязки к определенному хосту, так же это даст стабильность, когда какой-то зависимый хост не доступен по какой-либо причине.

4. Отлов ошибок
   - Не "проглатывать" ошибки - отправляйте их в логгер
   - Особое внимание к ошибкам в асинхронном коде, так как такие ошибки ни PluginManager, ни Vue не сможет отловить

   Используйте логгер из utils:
    ```js
   const { Logger } = Yskra.import('utils');
   const logger = new Logger('loggerID');

   logger.error('Error message');
   ```

5. Все запросы к внешнему API должны иметь таймаут ожидания

   Это позволит не зависать на долго вашему плагину, если API не доступен (Chromium имеет 300 секунд таймаута для запросов)

:::: details Пример кода
::: code-group
```js [fetch]
const controller = new AbortController();
const timeout = 5000;

const timeoutId = setTimeout(controller.abort, timeout);

fetch('https://api.example.com/data', { signal: controller.signal })
        .finally(() => clearTimeout(timeoutId));
```
```js [useFetch]
const { useFetch } = Yskra.import('utils');
const timeout = 5000;

useFetch('https://api.example.com/data', { timeout })
```
:::
::::


## Безопасность {#security}

1. Плагин не должен удалять функции безопасности

2. Плагин не должен использовать библиотеки с закрытым исходным кодом
